# ShortcutManager - 全局快捷键管理

## 组件概述

**文件路径:** `src/helpers/ipc/shortcut/shortcut-manager.ts`  
**角色:** 单例管理器 - 全局快捷键  
**层级:** 基础设施层

`ShortcutManager`是一个基于单例模式的类，负责管理Electron应用中的全局快捷键。它封装了Electron的`globalShortcut`模块，提供了一个统一的接口来注册、注销和触发全局快捷键，并负责将快捷键事件通过IPC通信传递给渲染进程。

## 核心功能

- 全局快捷键的注册与注销
- 应用生命周期事件的监听与处理
- 快捷键事件的IPC通信
- 多平台键盘快捷键兼容性处理

## 实现细节

### 单例模式

- 通过静态`getInstance()`方法确保全应用只有一个`ShortcutManager`实例
- 私有构造函数防止直接实例化
- 懒加载模式，只在首次访问时创建实例

### 快捷键管理

- `registerShortcut()`: 注册单个全局快捷键
- `unregisterShortcut()`: 注销单个全局快捷键
- `unregisterAll()`: 注销所有已注册的快捷键
- 自动处理快捷键格式转换，适配不同平台

### 生命周期管理

- `init()`: 初始化管理器，设置应用程序事件监听
- 监听应用程序的`will-quit`事件，确保在应用退出前注销所有快捷键
- 监听窗口焦点变化事件，可选择性地在失去焦点时禁用快捷键

### 事件通信

- 使用`BrowserWindow.webContents.send()`将快捷键事件发送到渲染进程
- 使用`SHORTCUT_EVENT_CHANNEL`作为IPC通信通道
- 支持向指定窗口或所有窗口广播快捷键事件

## 与其他模块的关系

- 依赖`shortcut-channels.ts`中定义的IPC通道名称
- 与`shortcut-context.ts`配合，实现主进程到渲染进程的事件传递
- 可以使用`hotkey_helpers.ts`中的辅助函数进行快捷键格式转换
- 在`main.ts`中初始化并使用

## 使用场景

- 注册全局应用快捷键，如显示/隐藏窗口
- 实现系统级别的热键功能
- 统一管理所有全局快捷键，避免冲突
- 实现跨窗口的快捷键事件处理

## 技术考量

- **性能:** 高效管理快捷键注册和事件分发
- **内存管理:** 确保适当注销快捷键，避免内存泄漏
- **跨平台兼容:** 处理不同操作系统平台上的快捷键差异
- **安全性:** 只允许主进程注册全局快捷键，遵循Electron安全最佳实践

## 开发者注释

- 所有涉及全局快捷键的操作都应通过ShortcutManager进行
- 使用`getInstance().init()`在应用启动时初始化
- 在应用退出前会自动注销所有快捷键，无需手动清理
- 可以配置`unregisterOnWindowBlur`选项，在窗口失去焦点时自动禁用快捷键 